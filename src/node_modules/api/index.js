import request from 'superagent'

const appId = 'c28d3573';
const appKey = '411ca5342798527424d0aac10b9d542f'

let inredientsToMore = ``

export const fetchRecipes = async (text) => {
  let ingredients = ``
  const arrIngredients = text.split(',')
  for (let i = 0; i < arrIngredients.length; i++) {
    let temp = arrIngredients[i].trim().replace(/ /ig, '+')
    ingredients += `&allowedIngredient[]=${temp}` 
  }
  

  const {body} = await request.get(
    `http://api.yummly.com/v1/api/recipes?_app_id=${appId}&_app_key=${appKey}${ingredients}&requirePictures=true`
  )

  if (body.matches.length !== 0)
    inredientsToMore = ingredients 

  return body.matches
}

export const loadMoreRecipes = async ({offset}) => {
  const {body} = await request.get(
    `http://api.yummly.com/v1/api/recipes?_app_id=${appId}&_app_key=${appKey}${inredientsToMore}&requirePictures=true&maxResult=${offset}&start=${offset}`
  )

  return body.matches
}

export const fetchRecipeById = async id => {
  const {body} = await request.get(
    `http://api.yummly.com/v1/api/recipe/${id}?_app_id=${appId}&_app_key=${appKey}&requirePictures=true`
  )

  return body
}

export const basketCheckout = async (id) => {
  let recipesBasket = []

  for (let i = 0; i < id.length; i++) {
    const recipeId = id[i]
    const {body} = await request.get(
      `http://api.yummly.com/v1/api/recipe/${recipeId}?_app_id=${appId}&_app_key=${appKey}&requirePictures=true`
    )
    recipesBasket[i] = body
  }

  for (let i = 0; i < recipesBasket.length; i++) {
    const recipe = recipesBasket[i].ingredientLines
    let counter = 0
    let startNumber

    for (let j = 1; j < recipe.length; j++) {
      if (recipe[j] === recipe[j-1]) {
        if (!startNumber) {
          startNumber = j
        }
        counter++
      }
    }
    recipe.splice(startNumber, counter)
    console.log('recipe',recipe)    
    console.log('startNumber',startNumber)
    console.log('counter',counter)
  }

  return recipesBasket
}