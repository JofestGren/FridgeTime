import React, {Component} from 'react'
import {connect} from 'react-redux'
import * as R from 'ramda'
import {Link} from 'react-router'

import {
  getBasketRecipes,
  getTotalBasketTime,
} from 'selectors'

import {
  removeRecipeFromBasket,
  cleanBasket
} from 'actions'

import Header from 'components/header'
import Footer from 'components/footer'

import './index.sass'

class Basket extends Component {
  renderIngredientList (recipe, index) {
    return (
      <div className='basket-ingredients-list-content' key={index}>
        <div>
          {recipe.ingredientLines.map((value, key) => (
            <div key={key}>
              <div>
                {value}
              </div>
            </div>
          ))}
        </div>
      </div>
    )
  }

  renderBasket () {
    const {recipes, totalTime, removeRecipeFromBasket} = this.props
    return (
      <div className='basket'>
        <div className='basket-list'>
          <div className='basket-info__title'>
            <h4>Chosen list</h4>
          </div>
          <div className='basket-info'>
            <div>
              <div className='basket-info__block'>
                {recipes.map((recipe, index) => (
                  <div 
                    className='basket-body'
                    key={index}
                  >
                    <div>
                      <img
                        src={recipe.images[0].hostedSmallUrl}
                        alt={recipe.name}
                        className='basket-image'
                      />
                    </div>
                    <div>
                      <Link 
                        to={`/recipes/${recipe.id}`}
                        className='basket-name__link'
                      >
                        {recipe.name}
                      </Link>
                    </div>
                    <div>
                      <span>  {recipe.totalTime}</span>
                    </div>
                    <div className='basket-delete-block'>
                      <span
                        className='basket-delete'
                        onClick={() => removeRecipeFromBasket(recipe.id)}
                      />         
                    </div>
                  </div>
                ))}
              </div>
            </div>
          </div>
          <div className='basket-total-time'>
            <div className='basket-total-time__name'>
              <span>Total time:</span>
            </div>
            <div>
              <span>{totalTime} min</span>
            </div>
          </div>
        </div>
        <div className='basket-ingredients-list'>
          {
            <div>
              <div className='basket-info__title'>
                <h4>All ingredients</h4>
              </div>
              {
                recipes.map((recipe, index) => this.renderIngredientList(recipe, index))
              }
            </div>
          }
        </div>
      </div>
    )
  }

  renderSidebarOption () {
    const {cleanBasket} = this.props
    return (
      <div className='basket-sidebar__buttons'>
        <button
          onClick={cleanBasket}
          className='basket-sidebar__btn basket-sidebar__btn--clearList'
        >
          Clear list
        </button>
      </div>
    )
  }

  renderSidebar () {
    const {recipes} = this.props
    const isBasketEmpty = R.isEmpty(recipes)
    return (
      <div className='basket-sidebar'>
        {
          isBasketEmpty &&
          <div className='basket-sidebar-link basket-sidebar-link--empty'>
            <Link 
              className='basket-sidebar__btn basket-sidebar__btn--title basket-sidebar__btn--backToHome'
              to='/'
            >
              <span>Back to home</span>
            </Link>
          </div>
        }
        {
          R.not(isBasketEmpty) &&
          <div className='basket-sidebar-link'>
            <Link 
              className='basket-sidebar__btn basket-sidebar__btn--title basket-sidebar__btn--backToHome'
              to='/'
            >
              <span>Back to home</span>
            </Link>
          </div>
        }
        {R.not(isBasketEmpty) && this.renderSidebarOption()}
      </div>
    )
  }

  renderBanner () {
    return (
      <div className='basket-banner__desc'>
        <span>Your chosen list is empty</span>
      </div>
    )
  }

  render () {
    const {recipes} = this.props
    return (
      <div>
        <Header />
        <div className='basket-container'>
          <div className='basket-row'>
            <div className='basket-content'>
              {
                recipes.length !== 0 && recipes ?
                this.renderBasket() :
                this.renderBanner()
              }
            </div>
            <div>
              {recipes && this.renderSidebar()}
            </div>
          </div>
        </div>
        <Footer />
      </div>
    )
  }
}

const mapStateToProps = state => {
  return {
    recipes: getBasketRecipes(state),
    totalTime: getTotalBasketTime(state),
  }
}

const mapDispatchToProps = {
  removeRecipeFromBasket,
  cleanBasket
}

export default connect(mapStateToProps, mapDispatchToProps)(Basket)